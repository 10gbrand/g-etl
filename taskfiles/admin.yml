version: '3'

tasks:
  run:
    desc: Starta admin TUI lokalt
    cmds:
      - uv run python -m scripts.admin.app

  mock:
    desc: Starta admin TUI i mock-l채ge
    cmds:
      - uv run python -m scripts.admin.app --mock

  docker:
    desc: Starta admin TUI i Docker-container
    dir: docker
    cmds:
      - docker compose run --rm -it admin

  docker-mock:
    desc: Starta admin TUI i Docker (mock-l채ge)
    dir: docker
    cmds:
      - docker compose run --rm -it admin --mock

  docker-build:
    desc: Bygg admin Docker-image
    dir: docker
    cmds:
      - docker compose build admin

  cleanup:
    desc: Rensa gamla databasfiler (beh책ll 3 senaste)
    cmds:
      - uv run python -c "from scripts.admin.services.db_session import cleanup_old_databases; removed = cleanup_old_databases(3); print(f'Tog bort {len(removed)} filer')"

  list-db:
    desc: Lista alla session-databaser
    cmds:
      - uv run python -c "from scripts.admin.services.db_session import list_databases; [print(f'{p.name}') for p, _, s in list_databases()]"

  build:
    desc: Bygg frist책ende executable med PyInstaller
    cmds:
      - uv pip install pyinstaller
      - uv run pyinstaller g_etl.spec
    generates:
      - dist/g-etl*

  build-clean:
    desc: Rensa build-artefakter
    cmds:
      - rm -rf build/ dist/ *.spec.bak

  build-nuitka:
    desc: Bygg Linux-executable med Nuitka i Docker
    cmds:
      - docker build -f Dockerfile.nuitka -t g-etl-nuitka .
      - mkdir -p dist/nuitka
      - docker run --rm -v {{.USER_WORKING_DIR}}/dist/nuitka:/output g-etl-nuitka cp /build/app.bin /output/g_etl
    generates:
      - dist/nuitka/*
