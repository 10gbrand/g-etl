version: '3'

tasks:
  run:
    desc: Starta admin TUI lokalt
    cmds:
      - uv run python -m scripts.admin.app

  mock:
    desc: Starta admin TUI i mock-läge
    cmds:
      - uv run python -m scripts.admin.app --mock

  docker:
    desc: Starta admin TUI i Docker-container
    dir: docker
    cmds:
      - docker compose run --rm -it admin

  docker-mock:
    desc: Starta admin TUI i Docker (mock-läge)
    dir: docker
    cmds:
      - docker compose run --rm -it admin --mock

  docker-build:
    desc: Bygg admin Docker-image
    dir: docker
    cmds:
      - docker compose build admin

  cleanup:
    desc: Rensa gamla databasfiler (behåll 3 senaste)
    cmds:
      - uv run python -c "from scripts.admin.services.db_session import cleanup_old_databases; removed = cleanup_old_databases(3); print(f'Tog bort {len(removed)} filer')"

  list-db:
    desc: Lista alla session-databaser
    cmds:
      - uv run python -c "from scripts.admin.services.db_session import list_databases; [print(f'{p.name}') for p, _, s in list_databases()]"
